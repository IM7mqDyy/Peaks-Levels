const getXpFor = (level) => {
  if (level == 0) {
    level = 0;
  } else if (level == 1) {
    level = 82;
  } else if (level == 2) {
    level = 208;
  } else if (level == 3) {
    level = 494;
  } else if (level == 4) {
    level = 973;
  } else if (level == 5) {
    level = 1670;
  } else if (level == 6) {
    level = 2618;
  } else if (level == 7) {
    level = 3844;
  } else if (level == 8) {
    level = 5279;
  } else if (level == 9) {
    level = 6966;
  } else if (level == 10) {
    level = 8800;
  } else if (level == 11) {
    level = 10884;
  } else if (level == 12) {
    level = 13170;
  } else if (level == 13) {
    level = 15734;
  } else if (level == 14) {
    level = 18503;
  } else if (level == 15) {
    level = 21406;
  } else if (level == 16) {
    level = 24508;
  } else if (level == 17) {
    level = 27850;
  } else if (level == 18) {
    level = 31417;
  } else if (level == 19) {
    level = 35104;
  } else if (level == 20) {
    level = 38923;
  } else if (level == 21) {
    level = 42825;
  } else if (level == 22) {
    level = 46853;
  } else if (level == 23) {
    level = 50946;
  } else if (level == 24) {
    level = 56048;
  } else if (level == 25) {
    level = 60257;
  } else if (level == 26) {
    level = 64558;
  } else if (level == 27) {
    level = 69053;
  } else if (level == 28) {
    level = 73622;
  } else if (level == 29) {
    level = 78231;
  } else if (level == 30) {
    level = 83010;
  } else if (level == 31) {
    level = 87813;
  } else if (level == 32) {
    level = 92663;
  } else if (level == 33) {
    level = 97585;
  } else if (level == 34) {
    level = 102554;
  } else if (level == 35) {
    level = 107556;
  } else if (level == 36) {
    level = 112625;
  } else if (level == 37) {
    level = 117727;
  } else if (level == 38) {
    level = 122873;
  } else if (level == 39) {
    level = 128037;
  } else if (level == 40) {
    level = 133242;
  } else if (level == 41) {
    level = 138480;
  } else if (level == 42) {
    level = 143739;
  } else if (level == 43) {
    level = 149041;
  } else if (level == 44) {
    level = 154361;
  } else if (level == 45) {
    level = 159715;
  } else if (level == 46) {
    level = 165097;
  } else if (level == 47) {
    level = 170499;
  } else if (level == 48) {
    level = 175926;
  } else if (level == 49) {
    level = 181395;
  } else if (level == 50) {
    level = 186880;
  } else if (level == 51) {
    level = 192382;
  } else if (level == 52) {
    level = 197907;
  } else if (level == 53) {
    level = 203441;
  } else if (level == 54) {
    level = 208983;
  } else if (level == 55) {
    level = 214572;
  } else if (level == 56) {
    level = 220174;
  } else if (level == 57) {
    level = 225803;
  } else if (level == 58) {
    level = 231445;
  } else if (level == 59) {
    level = 237105;
  } else if (level == 60) {
    level = 242794;
  } else if (level == 61) {
    level = 248498;
  } else if (level == 62) {
    level = 254224;
  } else if (level == 63) {
    level = 259966;
  } else if (level == 64) {
    level = 265729;
  } else if (level == 65) {
    level = 271511;
  } else if (level == 66) {
    level = 277310;
  } else if (level == 67) {
    level = 283113;
  } else if (level == 68) {
    level = 288949;
  } else if (level == 69) {
    level = 294794;
  } else if (level == 70) {
    level = 300663;
  } else if (level == 71) {
    level = 306553;
  } else if (level == 72) {
    level = 312459;
  } else if (level == 73) {
    level = 318399;
  } else if (level == 74) {
    level = 324382;
  } else if (level == 75) {
    level = 335493;
  } else if (level == 76) {
    level = 344000;
  } else if (level == 77) {
    level = 355000;
  } else if (level == 78) {
    level = 364000;
  } else if (level == 79) {
    level = 375000;
  } else if (level == 80) {
    level = 384000;
  } else if (level == 81) {
    level = 395000;
  } else if (level == 82) {
    level = 404000;
  } else if (level == 83) {
    level = 415000;
  } else if (level == 84) {
    level = 424000;
  } else if (level == 85) {
    level = 435000;
  } else if (level == 86) {
    level = 444000;
  } else if (level == 87) {
    level = 455000;
  } else if (level == 88) {
    level = 464000;
  } else if (level == 89) {
    level = 475000;
  } else if (level == 90) {
    level = 484000;
  } else if (level == 91) {
    level = 495000;
  } else if (level == 92) {
    level = 504000;
  } else if (level == 92) {
    level = 515000;
  } else if (level == 93) {
    level = 524000;
  } else if (level == 94) {
    level = 535000;
  } else if (level == 95) {
    level = 544000;
  } else if (level == 96) {
    level = 555000;
  } else if (level == 97) {
    level = 564000;
  } else if (level == 98) {
    level = 575000;
  } else if (level == 99) {
    level = 584000;
  } else if (level == 100) {
    level = 595000;
  } else if (level == 101) {
    level = 604000;
  } else if (level == 102) {
    level = 615000;
  } else if (level == 103) {
    level = 624000;
  } else if (level == 104) {
    level = 635000;
  } else if (level == 105) {
    level = 644000;
  } else if (level == 106) {
    level = 655000;
  } else if (level == 107) {
    level = 664000;
  } else if (level == 108) {
    level = 675000;
  } else if (level == 109) {
    level = 684000;
  } else if (level == 110) {
    level = 695000;
  } else if (level == 111) {
    level = 704000;
  } else if (level == 112) {
    level = 715000;
  } else if (level == 113) {
    level = 724000;
  } else if (level == 114) {
    level = 735000;
  } else if (level == 115) {
    level = 744000;
  } else if (level == 116) {
    level = 755000;
  } else if (level == 117) {
    level = 764000;
  } else if (level == 118) {
    level = 775000;
  } else if (level == 119) {
    level = 784000;
  } else if (level == 120) {
    level = 795000;
  } else if (level == 121) {
    level = 804000;
  } else if (level == 122) {
    level = 815000;
  } else if (level == 123) {
    level = 824000;
  } else if (level == 124) {
    level = 835000;
  } else if (level == 125) {
    level = 844000;
  } else if (level == 126) {
    level = 855000;
  } else if (level == 127) {
    level = 864000;
  } else if (level == 128) {
    level = 875000;
  } else if (level == 129) {
    level = 884000;
  } else if (level == 130) {
    level = 895000;
  } else if (level == 131) {
    level = 904000;
  } else if (level == 132) {
    level = 915000;
  } else if (level == 133) {
    level = 924000;
  } else if (level == 134) {
    level = 935000;
  } else if (level == 135) {
    level = 944000;
  } else if (level == 136) {
    level = 955000;
  } else if (level == 137) {
    level = 954000;
  } else if (level == 138) {
    level = 965000;
  } else if (level == 139) {
    level = 974000;
  } else if (level == 140) {
    level = 985000;
  } else if (level == 141) {
    level = 994000;
  } else if (level == 142) {
    level = 1015000;
  } else if (level == 143) {
    level = 1024000;
  } else if (level == 144) {
    level = 1035000;
  } else if (level == 145) {
    level = 1044000;
  } else if (level == 146) {
    level = 1055000;
  } else if (level == 147) {
    level = 1064000;
  } else if (level == 148) {
    level = 1075000;
  } else if (level == 149) {
    level = 1084000;
  } else if (level == 150) {
    level = 1095000;
  } else if (level == 151) {
    level = 1104000;
  } else if (level == 152) {
    level = 1115000;
  } else if (level == 153) {
    level = 1124000;
  } else if (level == 154) {
    level = 1135000;
  } else if (level == 155) {
    level = 1144000;
  } else if (level == 156) {
    level = 1155000;
  } else if (level == 157) {
    level = 1164000;
  } else if (level == 158) {
    level = 1175000;
  } else if (level == 159) {
    level = 1184000;
  } else if (level == 160) {
    level = 1195000;
  } else if (level == 161) {
    level = 1204000;
  } else if (level == 162) {
    level = 1215000;
  } else if (level == 163) {
    level = 1224000;
  } else if (level == 164) {
    level = 1235000;
  } else if (level == 165) {
    level = 1244000;
  } else if (level == 166) {
    level = 1255000;
  } else if (level == 167) {
    level = 1264000;
  } else if (level == 168) {
    level = 1275000;
  } else if (level == 169) {
    level = 1284000;
  } else if (level == 170) {
    level = 1295000;
  } else if (level == 171) {
    level = 1304000;
  } else if (level == 172) {
    level = 1315000;
  } else if (level == 173) {
    level = 1324000;
  } else if (level == 174) {
    level = 1335000;
  } else if (level == 175) {
    level = 1344000;
  } else if (level == 176) {
    level = 1355000;
  } else if (level == 177) {
    level = 1364000;
  } else if (level == 178) {
    level = 1375000;
  } else if (level == 179) {
    level = 1384000;
  } else if (level == 180) {
    level = 1395000;
  } else if (level == 181) {
    level = 1404000;
  } else if (level == 182) {
    level = 1415000;
  } else if (level == 183) {
    level = 1424000;
  } else if (level == 184) {
    level = 1435000;
  } else if (level == 185) {
    level = 1444000;
  } else if (level == 186) {
    level = 1455000;
  } else if (level == 187) {
    level = 1464000;
  } else if (level == 188) {
    level = 1475000;
  } else if (level == 189) {
    level = 1484000;
  } else if (level == 190) {
    level = 1495000;
  } else if (level == 191) {
    level = 1504000;
  } else if (level == 192) {
    level = 1515000;
  } else if (level == 193) {
    level = 1524000;
  } else if (level == 194) {
    level = 1535000;
  } else if (level == 195) {
    level = 1544000;
  } else if (level == 196) {
    level = 1556000;
  } else if (level == 197) {
    level = 1564000;
  } else if (level == 198) {
    level = 1575000;
  } else if (level == 199) {
    level = 1586000;
  } else if (level == 200) {
    level = 1600000;
  } else {
    level = 1600000;
  }

  return level;
};

let x = 0;
const arr = [];

for (var i = 1; i < 196; i++) {
  let d = getXpFor(i);
  arr.push(d);
}

const getLevel = (xp) => {
  let level = 0;

  for (let x of arr) {
    let index = arr.findIndex((a) => a === x);
    if (arr[index] === xp) {
      level = index;
    }
    if (getXpFor(1) > xp) {
      level = -1;
    }
    if (getXpFor(195) < xp) {
      level = index;
    }
    if (arr[index] < xp && xp < arr[index + 1]) {
      level = index;
    }
  }

  const thislevel = {
    i: level + 1,
    xp: getXpFor(level + 1),
  };

  const nextlevel = {
    i: level >= 195 ? 195 : level + 2,
    xp:
      level >= 195
        ? getXpFor(195)
        : getXpFor(thislevel.i + 1) - getXpFor(level + 1),
  };

  return {
    total: xp,

    level: thislevel,
    nextlevel,

    counter: {
      thislvlxp: xp - thislevel.xp,
    },
  };
};

const getXpPerLevel = (xp) => {
  let x = 0;
  let l = 0;

  for (var i = 0; i < 195; i++) {
    x = x + getXpFor(i);
    l = i;
    if (x == xp) return x - xp;
    if (x > xp) return x - xp;
  }
};

const getXpOfLevel = (xp) => {
  let x = getLevel(xp);
  let xx = xp;

  for (var i = 0; i < x; i++) {
    xx = xx - getXpFor(i);
  }

  return xx;
};

const rankOfUser = (data, userID) => {
  let array = [];

  Object.keys(data).forEach((user) => {
    array.push({ userID: user, xp: data[user] });
  });

  array = array.sort((a, b) => b.xp - a.xp);

  return array.findIndex((d) => d.userID === userID) + 1 || "Not ranked";
};

const checkwords = (message, bot) => {
  if (!bot.utils.guildsXp[message.guild.id]) {
    bot.utils.guildsXp[message.guild.id] = {};
  }

  if (!bot.utils.guildsXp[message.guild.id][message.author.id]) {
    bot.utils.guildsXp[message.guild.id][message.author.id] = {
      xp: 0,
      lastWords: [],
      counter: 0,
      channelID: message.channel.id,
    };
  }

  bot.utils.guildsXp[message.guild.id][message.author.id].channelID =
    message.channel.id;

  let words = message.content.split(" ");
  let awords =
    bot.utils.guildsXp[message.guild.id][message.author.id].lastWords || [];
  let ext = awords.filter((word) => words.includes(word));

  bot.utils.guildsXp[message.guild.id][message.author.id].lastWords =
    words.concat(awords);
  if (ext.length > 0)
    return bot.utils.guildsXp[message.guild.id][message.author.id];
  if (bot.utils.guildsXp[message.guild.id][message.author.id].counter > 4) {
    bot.utils.guildsXp[message.guild.id][message.author.id].lastWords = [];
    bot.utils.guildsXp[message.guild.id][message.author.id].counter = 0;
    bot.utils.guildsXp[message.guild.id][message.author.id].xp++;
  }
  bot.utils.guildsXp[message.guild.id][message.author.id].counter++;

  return bot.utils.guildsXp[message.guild.id][message.author.id];
};

const checkvoice = (guild, member, channel, bot) => {
  if (!bot.utils.guildsVoiceXp[guild.id]) {
    bot.utils.guildsVoiceXp[guild.id] = {};
  }

  if (!bot.utils.guildsVoiceXp[guild.id][member.id]) {
    bot.utils.guildsVoiceXp[guild.id][member.id] = {
      xp: 0,
      channelID: channel.id,
    };
  }

  bot.utils.guildsVoiceXp[guild.id][member.id].channelID = channel.id;
  bot.utils.guildsVoiceXp[guild.id][member.id].xp++;

  return bot.utils.guildsVoiceXp[guild.id][member.id];
};

const getTasks = (object) => {
  const arr = [];

  Object.keys(object).forEach((number) => {
    arr.push(number);
  });

  let obj = {};

  let num = 1;

  for (let values of arr) {
    if (num === 1) {
      if (!obj[values])
        obj[values] = {
          done: object[values].done,
          content: object[values].content,
          y: 110,
          z: 375,
          yy: 238.5,
          zz: 75,
          w: 333,
        };
    } else if (num === 2) {
      75;
      if (!obj[values])
        obj[values] = {
          done: object[values].done,
          content: object[values].content,
          y: 110,
          z: 455,
          yy: 238.5,
          zz: 75,
          w: 413,
        };
    } else if (num === 3) {
      if (!obj[values])
        obj[values] = {
          done: object[values].done,
          content: object[values].content,
          y: 110,
          z: 535,
          yy: 238.5,
          zz: 75,
          w: 493,
        };
    }

    num++;
  }

  return obj;
};

module.exports = {
  getTasks,
  getLevel,
  getXpFor,
  checkwords,
  rankOfUser,
  checkvoice,
};
